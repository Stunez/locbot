info = {
"restoran": [
	{
	'id' : 1,
	'range' : 0,
	'adress' : 'Коктем 3-й микрорайон, 16а',
	'name' : 'Посейдон',
	'vid' : 'Ресторан',
	'worktime' : 'Работает ежедневно 10:00–01:00',
	'phone' : '+7 (727) 394‒51‒15',
	'instagram' : None,
	'оценка' : 4.2,
	'location' : {
			"lat1" : 43.235960, 
			'lon1' : 76.914459,
		}
	},
	{
	'id' : 2,
	'range' : 0,
	'adress' : 'БЦ Almaty Towers Байзакова, 280',
	'name' : 'Башня',
	'vid' : 'Ресто-бар',
	'worktime' : 'Работает ежедневно 09:00–03:00',
	'phone': '+7‒775‒641‒02‒22',
	'оценка' : 4.5,
	'instagram' : 'https://www.instagram.com/restobar_bashnya/?hl=ru',
	"location" : 
		{
			'lat2' : 43.237328,

			'lon2' : 76.914985,
			},
	},
	
	{
	'id' : 3,
	'range' : 0,
	'adress' : 'Гагарина проспект, 292',
	'name' : 'Шах',
	'vid' : 'cеть ресторанов и кулинарий',
	'worktime' : 'Работает ежедневно 10:00–02:00',
	'phone': '+7‒747‒420‒22‒49',
	'оценка' : 4,
	'instagram' : 'https://www.instagram.com/shakh_restaurant/',
	"location" : {
		
			'lat3' : 43.240199,

			'lon3' : 76.905399, 
			},
		},
	
	{
	'id' : 4,
	'range' : 0,
	'adress' : 'Абылай хана проспект, 125',
	'name' : 'Лето Маркет',
	'vid' : 'ресторан-гастроном ',
	'worktime' : 'Работает ежедневно 08:00–01:00',
	'phone': '+7‒778‒555‒66‒65',
	'оценка' : 5,
	'instagram' : 'https://www.instagram.com/leto_market_kz/',
	"location" : {
		
			'lat3' : 43.247478,

			'lon3' : 76.942109,
			},
		},
	
	{
	'id' : 5,
	'range' : 0,
	'adress' : 'Сейфуллина проспект, 481 — 2 этаж',
	'name' : 'Caviar',
	'vid' : 'ресторанов',
	'worktime' : 'Работает ежедневно 10:00–02:00',
	'phone': '+7 (727) 299‒66‒99',
	'оценка' : 5,
	'instagram' : 'https://www.instagram.com/esperanzakz/',
	"location" : {
		
			'lat3' : 43.265517,

			'lon3' : 76.930399, 
			},
		},
	{
	'id' : 6,
	'range' : 0,
	'adress' : 'Гагарина проспект, 292',
	'name' : 'BAR 111',
	'vid' : 'гастрономический бар',
	'worktime' : 'Работает ежедневно 10:00–02:00',
	'phone': '+7‒777‒777‒77‒77',
	'оценка' : 5,
	'instagram' : 'https://www.instagram.com/bar_111_almaty/',
	"location" : {
		
			'lat3' : 43.233687,

			'lon3' : 76.958323, 
			},
		},
	{
	'id' : 7,
	'range' : 0,
	'adress' : 'Толе би, 24Б — 1 этаж',
	'name' : 'Saebiz',
	'vid' : 'ресторан',
	'worktime' : 'Работает ежедневно 10:00–02:00',
	'phone': '+7‒777‒777‒77‒77',
	'оценка' : 4.4,
	'instagram' : 'https://www.instagram.com/saebiz_almaty/',
	"location" : {
		
			'lat3' : 43.255265,

			'lon3' : 76.954190, 
			},
		},
	{
	'id' : 8,
	'range' : 0,
	'adress' : 'БЦ KOKTEM GRAND Достык проспект, 210 блок Б — 1 этаж',
	'name' : 'QazaQ restaurant',
	'vid' : 'ресторан национальной авторской кухни',
	'worktime' : 'Работает ежедневно 10:00–02:00',
	'phone': '+7‒777‒777‒77‒77',
	'оценка' : 5,
	'instagram' : 'https://www.instagram.com/_qazaq_restaurant_/',
	"location" : {
		
			'lat3' : 43.230049,

			'lon3' : 76.960454, 
			},
		},
	{
	'id' : 9,
	'range' : 0,
	'adress' : 'Жамбыла, 77 — 1 этаж',
	'name' : 'Ларисс Иванну Хачу',
	'vid' : 'ресторан',
	'worktime' : 'Работает ежедневно 10:00–02:00',
	'phone': '+7‒777‒777‒77‒77',
	'оценка' : 4.2,
	'instagram' : 'https://www.instagram.com/bar_111_almaty/',
	"location" : {
		
			'lat3' : 43.247537,

			'lon3' : 76.937356, 
			},
		},
	{
	'id' : 10,
	'range' : 0,
	'adress' : 'Достык проспект, 248 — 1 этаж',
	'name' : 'Quality Restaurant & Karaoke',
	'vid' : 'ресторанный комплекс',
	'worktime' : 'Работает ежедневно 10:00–02:00',
	'phone': '+7‒777‒777‒77‒77',
	'оценка' : 4.7,
	'instagram' : 'https://www.instagram.com/bar_111_almaty/',
	"location" : {
		
			'lat3' : 43.222921,

			'lon3' : 76.963183, 
			},
		},
	{
	'id' : 11,
	'range' : 0,
	'adress' : 'ЖК Столичный Центр Кабанбай батыра, 87',
	'name' : 'KOREAN HOUSE',
	'vid' : 'ресторан корейской кухни',
	'worktime' : 'Работает ежедневно 10:00–02:00',
	'phone': '+7‒777‒777‒77‒77',
	'оценка' : 4.4,
	'instagram' : None,
	"location" : {
		
			'lat3' : 43.249876,
			'lon3' : 76.942752, 
			},
		},
	{
	'id' : 12,
	'range' : 0,
	'adress' : 'Брусиловского, 164 — 1 этаж',
	'name' : 'Arsha',
	'vid' : 'ресторанный комплекс',
	'worktime' : 'Работает ежедневно 10:00–02:00',
	'phone': '+7‒777‒777‒77‒77',
	'оценка' : 4.5,
	'instagram' : 'https://www.instagram.com/restoran_arsha/',
	"location" : {
		
			'lat3' : 43.240195,

			'lon3' : 76.878313, 
			},
		},
	{
	'id' : 13,
	'range' : 0,
	'adress' : 'Наурызбай батыра, 94 — 1 этаж',
	'name' : 'Double Coffee',
	'vid' : 'ресторан-кофейня',
	'worktime' : 'Работает ежедневно 10:00–02:00',
	'phone': '+7‒777‒777‒77‒77',
	'оценка' : 4.6,
	'instagram' : 'https://www.instagram.com/doublecoffee_almaty/',
	"location" : {
		
			'lat3' : 43.253870,

			'lon3' : 76.936613, 
			},
		},
	{
	'id' : 14,
	'range' : 0,
	'adress' : 'Абая проспект, 58а — 1 этаж',
	'name' : 'Аист',
	'vid' : 'семейный ресторан',
	'worktime' : 'Работает ежедневно 10:00–02:00',
	'phone': '+7‒777‒777‒77‒77',
	'оценка' : 4.3,
	'instagram' : 'https://www.instagram.com/aist_restaurant/',
	"location" : {
		
			'lat3' : 43.239558,

			'lon3' : 76.909395, 
			},
		},
	{
	'id' : 15,
	'range' : 0,
	'adress' : 'Ауэзова, 84а — 1 этаж',
	'name' : 'Пинта bar & grill',
	'vid' : 'сеть пивных ресторанов',
	'worktime' : 'Работает ежедневно 10:00–02:00',
	'phone': '+7‒777‒777‒77‒77',
	'оценка' : 3.3,
	'instagram' : 'https://www.instagram.com/pinta_almaty/',
	"location" : {
		
			'lat3' : 43.237152,

			'lon3' : 76.904755, 
			},
		},
]
}



import telebot
from telebot import types
import config
import requests
import json
from time import sleep
import datetime
from math import sin, cos, sqrt, atan2, radians

token = '641542217:AAHj-pmdV9Gg9IZ6epNOQDUCiLokDhKZiWs'
bot = telebot.TeleBot(token)
url = "https://api.telegram.org/bot641542217:AAHj-pmdV9Gg9IZ6epNOQDUCiLokDhKZiWs/"
last_update = 0

vozrostanieNum = []
vozrostanieName = []
@bot.message_handler(commands=["start"])
def inline(message):
	keyboard = types.ReplyKeyboardMarkup(row_width=1, resize_keyboard=True)
	#key = types.InlineKeyboardMarkup()
	button_geo = types.KeyboardButton(text="Обновить местоположение", request_location=True)
	keyboard.add(button_geo)#,but_2
	bot.send_message(message.chat.id, "Здравствуйте, я буду вашим помощником-ботом который поможет опредилить где самый ближайший ресторан и забронировать место")
	bot.send_message(message.chat.id, "Но для начало нам нужно чтобы вы поделились своим местоположением, и я рекомендую кажждый раз обновлять геолокацию", reply_markup=keyboard)

	#keyboard = types.ReplyKeyboardMarkup(row_width=1, resize_keyboard=True)
"""
@bot.message_handler(commands=["geo"])
def geo(message):
	keyboard = types.ReplyKeyboardMarkup(row_width=1, resize_keyboard=True)
	button_geo = types.KeyboardButton(text="Отправить местоположение", request_location=True)
	keyboard.add(button_geo)
	bot.send_message(message.chat.id, "Да, я конечно(отправить местоположение)", reply_markup=keyboard)
"""
@bot.message_handler(content_types=["location"])
def location(message):
	vozrostanieNum.clear()
	if message.location is not None:
		print(message.location)
		print("latitude: %s; longitude: %s" % (message.location.latitude, message.location.longitude))
		latinput = message.location.latitude
		loninput = message.location.longitude


		# approximate radius of earth in km


	def podchet():
			#задаем переменную для цикла
		R = 6373.0
		dlon = 0
		dlat = 0
		distance2 = 9999999999
		distance = 0
		latnum = 0
		for lat in info['restoran']:
			for x in lat['location']:
				#print (lat['location'][x])
				lat['location'][x] = float(lat['location'][x])
				for y in x:
					if y == 'o':
						dlon = radians(loninput) - radians(lat['location'][x])
						dlat = radians(latinput)- radians(latnum)
						a = sin(dlat / 2)**2 + cos(latnum) * cos(latinput) * sin(dlon / 2)**2
						c = 2 * atan2(sqrt(a), sqrt(1 - a))	
						distance = R * c
					elif y == 'a': 
						latnum = lat['location'][x]
						
				if distance == 0:
					pass
				elif distance2 > distance:
					distance2 = distance

			lat['range'] = distance
			#print (lat['range'])
		return distance2
	#------
	a = podchet()
	print("Result:", a)

	for lat in info['restoran']:
		vozrostanieNum.append(lat['range'])
	vozrostanieNum.sort()
	key = types.InlineKeyboardMarkup()
	but_1= types.InlineKeyboardButton(text="Список ближайших ресторанов", callback_data="Spisok")
	key.add(but_1)#,but_2
	bot.send_message(message.chat.id, "благодарю что поделились местоположением ^_^",reply_markup=key)
	
@bot.callback_query_handler(func=lambda c:True)
def inlin(c):
	if c.data == "Spisok":
		bot.send_message(c.message.chat.id,	"вот пожалуйста")
		count = 1
		count2 = 2
		bron = types.InlineKeyboardMarkup()
		
		but_3 = types.InlineKeyboardButton(text="Запрос на бронирование место", callback_data="брон")

		list1 = []
		
		for ranga in vozrostanieNum:
			
			instagram = list1
			instagram = types.InlineKeyboardMarkup()
			for name in info['restoran']:
				if ranga == name['range']:
					if ranga < 1:
						a = round(ranga,3)
						a = 1000 * a
						but_instagram = types.InlineKeyboardButton(text="instagram", url=name['instagram'] )
						instagram.add(but_instagram)
						
						bot.send_message(c.message.chat.id, (("%s.%s,%s \n %s \n Номер: %s \n Оценка: %s из 5 баллов \n адрес:%s \n от вас %s метрах")%(count,name['name'],name['vid'],name['worktime'],name['phone'],name['оценка'],name['adress'],a)), reply_markup=instagram)
					else:
						but_instagram = types.InlineKeyboardButton(text="instagram", url=name['instagram'] )
						instagram.add(but_instagram)
						bot.send_message(c.message.chat.id, (("%s.%s,%s \n %s \n Номер: %s \n Оценка: %s из 5 баллов \n адрес:%s \n от вас %s км")%(count,name['name'],name['vid'],name['worktime'],name['phone'],name['оценка'],name['adress'],round(ranga,2))), reply_markup=instagram)
				if count > 10:
					"""
					but_bron_1 = types.InlineKeyboardButton(text="№1", callback_data="брон")
					but_bron_2 = types.InlineKeyboardButton(text="№1", callback_data="брон")
					but_bron_3 = types.InlineKeyboardButton(text="№1", callback_data="брон")
					but_bron_4 = types.InlineKeyboardButton(text="№1", callback_data="брон")
					but_bron_5 = types.InlineKeyboardButton(text="№1", callback_data="брон")
					but_bron_6 = types.InlineKeyboardButton(text="№1", callback_data="брон")
					but_bron_7 = types.InlineKeyboardButton(text="№1", callback_data="брон")
					but_bron_8 = types.InlineKeyboardButton(text="№1", callback_data="брон")
					but_bron_9 = types.InlineKeyboardButton(text="№1", callback_data="брон")
					but_bron_10 = types.InlineKeyboardButton(text="№1", callback_data="брон")
					bron.add(but_3,but_4)
					"""
					bot.send_message(c.message.chat.id, "Хотите забронировать место в одном из этих ресторанов?", reply_markup=bron)


					break
			
			count2 += 2
			count += 1
		#bot.send_message(c.message.chat.id, '')
		
		#but_3 = types.InlineKeyboardButton(text="да", callback_data="да")
		#but_4 = types.InlineKeyboardButton(text="нет", callback_data="нет")
		#bron.add(but_3,but_4)
		bot.send_message(c.message.chat.id, "хотите встать в очередь?", reply_markup=bron)
		#ожидамое количество людей в очереди
	print (vozrostanieNum)

# We want to keep checking for updates. So this must be a never ending loop





	#------------------------




bot.polling(none_stop=True) 

	#--------------------